/**
 * 服务器框架
 *
 * @author <a href='wangyi@chukong-inc.com'>Shao</a>
 * @version 0.0.1
 * @date 2013.06.05
 */
var logger = require('ss-logger').getLogger(__filename);
var util = require('util');
var fs = require('fs');

module.exports = require('./lib/connector.js');

/*
 * 服务器异常日志处理
 */
process.on('uncaughtException', function(err) {

    if (logger) {
        logger.error('未知异常: %s', err.stack);
    } else {
        console.error('未知异常: ' + err.stack);
    }
    var d = new Date();
    var time = util.format('%d-%d-%d-%d-%d-%d', d.getFullYear(), d.getMonth() + 1, d.getDate(), d.getHours(), d.getMinutes(), d.getSeconds());
    var str = util.format('%s 未知异常: %s\n', time, err.stack);
    if (!fs.existsSync('./logs')) { //不存在就创建一个
        fs.mkdirSync('./logs', 0755)
    }
    fs.appendFile("logs/uncaughtException.log", str);
});